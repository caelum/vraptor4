<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - Converters</title> <link rel="stylesheet" href="../../../css/style.min.css"/> </head> <body> <header class="container"><h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"></a></h1> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul></header><input type="checkbox" id="nav-visibility"><label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"><ul> <li><a href="../../download">Download</a></li> <li><a href="../one-minute-guide/">Documentation</a></li> <li><a href="../../cookbook/accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/issues/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul></nav><nav class="doc-nav container"><h1>Documentation</h1> <ul> <li><a href="../one-minute-guide">One minute guide</a></li> <li><a href="../ten-minute-guide">Ten minute guide</a></li> <li><a href=".">Converters</a></li> <li><a href="../validation">Validation</a></li> <li><a href="../download-and-upload">Download and Upload</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../migrating-vraptor3-project">Migrating from VRaptor 3</a></li> </ul></nav><main class="container"><h1 id="when-to-use-a-converter">When to use a Converter?</h1> <p>When a parameter is received, we need to convert to an Object. VRaptor already have registered converters for all types define in <code>Java Language Specification</code>. If the type is primitive and parameter is <code>null</code>, the default value for the type will be returned. Example: if your type is an <code>int</code> and the value is <code>null</code>, the value <code>0</code> will be returned. For the non-primitive types the <code>null</code> value is returned if the parameter is <code>null</code> or empty.</p> <h2 id="bigdecimal-double-and-float-with-localization">BigDecimal, Double and Float with localization</h2> <p>Are supported using application locale. <code>Double</code> and <code>Float</code> supports both primitive and non-primitive types.</p> <h2 id="working-with-date-and-calendar">Working with Date and Calendar</h2> <p><code>Calendar</code> and <code>Date</code> are supported using application locale.</p> <p>There are converters for the main Joda-time types: <code>DateTime</code>, <code>LocalDate</code>, <code>LocalDateTime</code> and <code>LocalTime</code> available using the <b>vraptor-jodatime</b> plugin. More info <a href="../plugins">here</a>.</p> <p>If you are using JDK 8, you can use the new <code>java.time</code> API available using <b>vraptor-javatime</b> plugin. More info <a href="../plugins">here</a>.</p> <h2 id="if-conversion-fails">If conversion fails</h2> <p>When a conversion fails VRaptor will add the error message using localization. To see these messages you need to add the lines below in your resource bundle:</p> <pre><code class="language-xml">is_not_a_valid_number = {0} is not a valid number.
is_not_a_valid_integer = {0} is not a valid integer.
is_not_a_valid_character = {0} is not a valid character.
is_not_a_valid_enum_value = {0} is not a valid option.
is_not_a_valid_date = {0} is not a valid date.
is_not_a_valid_boolean = {0} is not a valid boolean. Please use true/false, yes/no, y/n or on/off
is_not_a_valid_time = {0} is not a valid time.
is_not_a_valid_datetime = {0} is not a valid datetime.</code></pre> <h2 id="changing-your-locale">Changing your Locale</h2> <p>The converters uses the JVM’s default locale. You can override the JVM locale adding these lines in your web.xml:</p> <pre><code class="language-xml"><span class="nt">&lt;context-param&gt;</span>
  <span class="nt">&lt;param-name&gt;</span>javax.servlet.jsp.jstl.fmt.locale<span class="nt">&lt;/param-name&gt;</span>
  <span class="nt">&lt;param-value&gt;</span>en_US<span class="nt">&lt;/param-value&gt;</span>
<span class="nt">&lt;/context-param&gt;</span></code></pre> <p>Or you can start your application server or servlet container using <code>-Duser.language=en -Duser.region=US</code> VM parameter.</p> <h2 id="creating-your-own-converter">Creating your own converter</h2> <p>All converters must implement VRaptor’s Converter interface. The concrete class will define which type it is able to convert, and will be invoked with a request parameter, the target type and a resource bundle containing i18n messages, useful if you wish to raise a ConversionException in case of convertion errors.</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Converter</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="n">T</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">);</span>
<span class="o">}</span></code></pre> <p>Also you must tell VRaptor (not the compiler) which type your converter is able to handle. You do that by annotating your converter class with @Convert:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span></code></pre> <p>Finally, don’t forget to specify the scope of your converter, just like you do with any other resource in VRaptor. For example, if your converter doesn’t need any user specific information, it can be registered as application scoped and only one instance of that converter will be created:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="c1">// ...</span>
<span class="o">}</span></code></pre> <p>In the following lines, you can see a LongConverter implementation, showing how simple it is to assemble all the information mentioned above:</p> <pre><code class="language-java"><span class="nd">@Convert</span><span class="o">(</span><span class="n">Long</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@ApplicationScoped</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LongConverter</span> <span class="kd">implements</span> <span class="n">Converter</span><span class="o">&lt;</span><span class="n">Long</span><span class="o">&gt;</span> <span class="o">{</span>

  <span class="kd">public</span> <span class="n">Long</span> <span class="nf">convert</span><span class="o">(</span><span class="n">String</span> <span class="n">value</span><span class="o">,</span> <span class="n">Class</span><span class="o">&lt;?</span> <span class="kd">extends</span> <span class="n">Long</span><span class="o">&gt;</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">isNullOrEmpty</span><span class="o">(</span><span class="n">value</span><span class="o">))</span> <span class="o">{</span>
      <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="k">try</span> <span class="o">{</span>
      <span class="k">return</span> <span class="n">Long</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">NumberFormatException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nf">ConversionException</span><span class="o">(</span><span class="k">new</span> <span class="n">ConversionMessage</span><span class="o">(</span><span class="s">"is_not_a_valid_integer"</span><span class="o">,</span> <span class="n">value</span><span class="o">));</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="overriding-core-converters">Overriding core converters</h2> <p>You can also overrise any existing converters. You only need extends the core converter and after to add <code>@Specializes</code> annotation. Below you can see an example how to override a converter <code>LocaleBasedBigDecimalConverter</code>:</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyCustomBigDecimalConverter</span> <span class="kd">extends</span> <span class="n">LocaleBasedBigDecimalConverter</span> <span class="o">{</span>
  <span class="kd">protected</span> <span class="n">NumberFormat</span> <span class="nf">getNumberFormat</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// my code here</span>
  <span class="o">}</span>
<span class="o">}</span></code></pre> </main> </body> </html>
