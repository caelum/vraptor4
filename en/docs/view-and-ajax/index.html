<!DOCTYPE HTML> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width"> <title>VRaptor 4 - View and Ajax</title> <link rel="shortcut icon" href="../../../img/favicon.png"> <link rel="stylesheet" href="/css/style.min.css"/> <meta name="generator" content="nanoc 3.6.7"> </head> <body> <header class="container"> <h1 class="logo"><a class="logo-link" href="../.."> <img src="../../../img/logo.png" alt="VRaptor"> </a></h1> <div class="header-links"> <ul class="community"> <li><a href="https://groups.google.com/forum/?hl=en#!forum/vraptor4" target="_blank">Google Groups</a></li> <li><a href="https://github.com/caelum/vraptor4/" target="_blank">GitHub</a></li> <li><a href="http://questions.vraptor.org" target="_blank">VRaptor Questions</a></li> </ul> <ul class="site-languages"> <li> <a class="site-language flag flag-en " title="en" href="../.."> EN </a> </li> <li> <a class="site-language flag flag-pt not-selected" title="pt" href="../../../pt"> PT </a> </li> </ul> <a href="../../search/" class="site-search-link">Go to search page</a> <form action="/en/search/" method="get" class="site-search-form"> <input type="search" name="q"> <button type="submit">Search</button> </form> </div> </header> <input type="checkbox" id="nav-visibility"> <label for="nav-visibility" class="nav-toggle">Menu</label> <nav class="main-nav"> <ul> <li><a href="../../download">Download</a></li> <li><a href="../one-minute-guide/">Documentation</a></li> <li><a href="../../cookbook/accepting-urls-ending-with-a-slash">Cookbook</a></li> <li><a href="https://github.com/caelum/vraptor4/releases" target="_blank">Changelog</a></li> <li><a href="https://github.com/caelum/vraptor4/milestones" target="_blank">Roadmap</a></li> <li><a href="../../../javadoc">Javadoc</a></li> </ul> </nav> <nav class="doc-nav container"> <h1>Documentation</h1> <ul> <li><a href="../one-minute-guide">One minute guide</a></li> <li><a href="../ten-minute-guide">Ten minute guide</a></li> <li><a href="../controllers-rest">REST Controllers</a></li> <li><a href="../components">Components</a></li> <li><a href="../converters">Converters</a></li> <li><a href="../validation">Validation</a></li> <li><a href="../interceptors">Interceptors</a></li> <li><a href="../events">Events</a></li> <li><a href=".">View and Ajax</a></li> <li><a href="../download-and-upload">Download and Upload</a></li> <li><a href="../environment">Environment</a></li> <li><a href="../plugins">Plugins</a></li> <li><a href="../dependencies-and-prerequisites">Dependencies and prerequisites</a></li> <li><a href="../testing-components-and-controllers">Testing Components and Controllers</a></li> <li><a href="../migrating-vraptor3-project">Migrating from VRaptor 3</a></li> <li><a href="../contributing-to-vraptor">Contributing to VRaptor</a></li> <li><a href="../articles-and-presentations">Articles and Presentations</a></li> </ul> </nav> <main class="container doc-container"> <h1 id="sharing-objects-with-view">Sharing objects with view</h1> <p>To register objects to be accessed by view, we use the <code>include</code> method:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">search</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"Some message"</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"client"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Client</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Now the variables <code>message</code> and <code>client</code> are available to use in your template engine. It’s possible to register the object by invoking the <code>include</code> method with only one argument:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">search</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"Some message"</span><span class="o">).</span><span class="na">include</span><span class="o">(</span><span class="k">new</span> <span class="n">Client</span><span class="o">(</span><span class="n">id</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>In this case, the first invocation registers the <code>string</code> key and the second registers the <code>client</code> key. You can change this behavior writing your own <code>TypeNameExtractor</code>.</p> <h2 id="custom-pathresolver">Custom PathResolver</h2> <p>By default, to render your views, VRaptor uses the convention:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span> 
        <span class="c1">//...</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>The method above will render the view <code>/WEB-INF/jsp/clients/list.jsp</code>. However, if you want to change this behavior for some reason, or if you want to use another template engine like Freemarker or Velocity, you just need to extend the <code>DefaultPathResolver</code> class.</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FreemarkerPathResolver</span> <span class="kd">extends</span> <span class="n">DefaultPathResolver</span> <span class="o">{</span>
    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getPrefix</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"/WEB-INF/freemarker/"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="n">String</span> <span class="nf">getExtension</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"ftl"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Thus the logic will render the view <code>/WEB-INF/freemarker/clients/list.ftl</code>. If you want more customization, you can implement the <code>PathResolver</code> interface. Remember that you need to annotate your implementation with <code>@Specializes</code> annotation.</p> <h2 id="view">View</h2> <p>If you want to change the view of some logic, you can use the <code>Result</code> object:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="n">Client</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//...</span>
        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">Results</span><span class="o">.</span><span class="na">logic</span><span class="o">()).</span><span class="na">redirectTo</span><span class="o">(</span><span class="n">ClientsController</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">list</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>There are these kinds of implemented views:</p> <table class="content-table"> <tbody> <tr> <td>Results.logic()</td> <td>will redirect to another logic method.</td> </tr> <tr> <td>Results.page()</td> <td>will redirect directly to one page, may be a JSP, HTML, or any URI on web application dir, or application context.</td> </tr> <tr> <td>Results.http()</td> <td>send informations of HTTP protocol with status code and headers.</td> </tr> <tr> <td>Results.status()</td> <td>send status code with more informations.</td> </tr> <tr> <td>Results.referer()</td> <td>use the header Referer to do redirects or forwards.</td> </tr> <tr> <td>Results.nothing()</td> <td>just returns the success code (HTTP 200 OK).</td> </tr> <tr> <td>Results.xml()</td> <td>serializes objects to XML.</td> </tr> <tr> <td>Results.json()</td> <td>serializes objects to JSON.</td> </tr> <tr> <td>Results.representation()</td> <td>serializes objects on a format determined by request (_format parameter or header Accept).</td> </tr> </tbody> </table> <h2 id="shortcuts-on-result">Shortcuts on Result</h2> <p>Some redirects are often used, so were created shortcuts for them. The available shortcuts are:</p> <table class="content-table"> <tbody> <tr> <td>result.forwardTo(“/some/uri”)</td> <td>result.use(page()).forward(“/some/uri”);</td> </tr> <tr> <td>result.redirectTo(“/some/uri”)</td> <td>result.use(page()).redirect(“/some/uri)</td> </tr> <tr> <td>result.permanentlyRedirectTo(“/some/uri”)</td> <td>result.use(status()).movedPermanentlyTo(“/some/uri”);</td> </tr> <tr> <td>result.forwardTo(ClientsController.class).list()</td> <td>result.use(logic()).forwardTo(ClientsController.class).list();</td> </tr> <tr> <td>result.redirectTo(ClientsController.class).list()</td> <td>result.use(logic()).redirectTo(ClientsController.class).list();</td> </tr> <tr> <td>result.of(ClientsController.class).list()</td> <td>result.use(page()).of(ClientsController.class).list();</td> </tr> <tr> <td>result.permanentlyRedirectTo(Controller.class)</td> <td>use(status()).movedPermanentlyTo(Controller.class);</td> </tr> <tr> <td>result.notFound()</td> <td>use(status()).notFound()</td> </tr> <tr> <td>result.nothing()</td> <td>use(nothing());</td> </tr> </tbody> </table> <p>Furthermore if the redirect is to another method in the same Controller, we can use:</p> <table class="content-table"> <tbody> <tr> <td>result.forwardTo(this).list()</td> <td>result.use(logic()).forwardTo(this.getClass()).list();</td> </tr> <tr> <td>result.redirectTo(this).list()</td> <td>result.use(logic()).redirectTo(this.getClass()).list();</td> </tr> <tr> <td>result.of(this).list()</td> <td>result.use(page()).of(this.getClass()).list();</td> </tr> <tr> <td>result.permanentlyRedirectTo(this)</td> <td>use(status()).movedPermanentlyTo(this.getClass());</td> </tr> </tbody> </table> <h2 id="redirect-and-forward">Redirect and forward</h2> <p>With VRaptor we can use both redirect or a forward to another logic or a JSP. Although they are Servlet API concepts, worth remembering the difference: the redirect happens on client side through HTTP codes that will make the browser access a new URL; forward happens on server side, totally transparent for the client/browser.</p> <p>A good redirect usage example is with ‘redirect-after-post’ pattern. As example: when you add a client and after the submitted form, the client is returned to the client’s listing page. Doing it with redirect, we prevent the user refresh the page (F5) and resubmit all the request, resulting in duplicate data.</p> <p>In the case of forward, an example of using is when you have a validation and it failed, often you want the user continues on the same screen of form with fulfilled data request, but internally you will make the forward to another business logic (that prepares the necessery data for the form).</p> <h2 id="automatic-flash-scope">Automatic Flash Scope</h2> <p>If you will add object in the <code>Result</code> and do a redirect, these objects will be available in the next request.</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="n">Client</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">dao</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">client</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"Client successfully added"</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">redirectTo</span><span class="o">(</span><span class="n">ClientsController</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">list</span><span class="o">();</span>
<span class="o">}</span></code></pre> <p>list.jsp:</p> <pre><code class="language-xml"><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"message"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h3&gt;</span>${message}<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;/div&gt;</span></code></pre> <h2 id="accepts-and-the-format-parameter">Accepts and the _format parameter</h2> <p>Many times, we need render different formats to the same logic. For example, we want return JSON instead of HTML. To do this, we can define the Header Accepts of request to accept the desired type, or put a <code>_format</code> parameter in the request.</p> <p>If it’s a JSON format, the view rendered by default will be: <code>/WEB-INF/jsp/{controller}/{logic}.json.jsp</code>, in other words, in general will be render the view: <code>/WEB-INF/jsp/{controller}/{logic}.{format}.jsp</code>. If the format is HTML you don’t need put it in the filename. The <code>_format</code> parameter has priority over the header Accepts.</p> <h2 id="ajax-building-in-view">Ajax: building in view</h2> <p>To return a JSON in your view, you just need to provide the object to the view, and inside the view you form the JSON as desired. As example, your <code>/WEB-INF/jsp/clients/load.json.jsp</code>:</p> <pre><code class="language-javascript"><span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">'${client.name}'</span><span class="p">,</span> <span class="nx">id</span><span class="o">:</span> <span class="s1">'${client.id}'</span> <span class="p">}</span></code></pre> <p>And the logic:</p> <pre><code class="language-java"><span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ClientDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">load</span><span class="o">(</span><span class="n">Client</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"client"</span><span class="o">,</span> <span class="n">dao</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">client</span><span class="o">));</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <h2 id="ajax-programmatic-version">Ajax: programmatic version</h2> <p>If you want the VRaptor automatically serialize your objects to XML or JSON, you can write in your logic:</p> <pre><code class="language-java"><span class="kn">import</span> <span class="nn">static</span> <span class="n">br</span><span class="o">.</span><span class="na">com</span><span class="o">.</span><span class="na">caelum</span><span class="o">.</span><span class="na">vraptor</span><span class="o">.</span><span class="na">view</span><span class="o">.</span><span class="na">Results</span><span class="o">.*;</span>
<span class="nd">@Controller</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientsController</span> <span class="o">{</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">Result</span> <span class="n">result</span><span class="o">;</span>

    <span class="nd">@Inject</span>
    <span class="kd">private</span> <span class="n">ClientDao</span> <span class="n">dao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadJson</span><span class="o">(</span><span class="n">Client</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">client</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadXml</span><span class="o">(</span><span class="n">Client</span> <span class="n">client</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">xml</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">client</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>The results will be simillar to:</p> <pre><code class="language-javascript"><span class="p">{</span><span class="s2">"client"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John"</span>
<span class="p">}}</span></code></pre> <p>and xml:</p> <pre><code class="language-xml"><span class="nt">&lt;client&gt;</span>
    <span class="nt">&lt;name&gt;</span>John<span class="nt">&lt;/name&gt;</span>
<span class="nt">&lt;/client&gt;</span></code></pre> <p>By default, just primitive types will be serialized (String, numbers, enums, dates), if you want include a field of non-primitive type you need include it explicitly:</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">client</span><span class="o">).</span><span class="na">include</span><span class="o">(</span><span class="s">"address"</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span><span class="s2">"client"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John"</span><span class="p">,</span>
    <span class="s2">"address"</span> <span class="p">{</span>
        <span class="s2">"street"</span><span class="o">:</span> <span class="s2">"Vergueiro"</span>
    <span class="p">}</span>
<span class="p">}}</span></code></pre> <p>You can also exclude some fields:</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">exclude</span><span class="o">(</span><span class="s">"password"</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span><span class="s2">"user"</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John"</span><span class="p">,</span>
    <span class="s2">"login"</span><span class="o">:</span> <span class="s2">"john"</span>
<span class="p">}}</span></code></pre> <p>You can also exclude or include many fields.</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">recursive</span><span class="o">().</span><span class="na">serialize</span><span class="o">();</span> <span class="c1">// includes all fields recursively</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">xml</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">exclude</span><span class="o">(</span><span class="s">"email"</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span> <span class="c1">// exclude the email field</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">xml</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">excludeAll</span><span class="o">().</span><span class="na">serialize</span><span class="o">();</span> <span class="c1">// excludes all fields</span></code></pre> <p>You can also add versioning capability to JSON based results. Through this resource it is possible to add API versioning. As a useful example, suppose that an API which returns a list of our system’s customers was created. The first version returns a list of customers defined by the structure that follows:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>    
    <span class="kd">private</span> <span class="n">String</span> <span class="n">group</span><span class="o">;</span>

    <span class="c1">// getters and setters omitted</span>
<span class="o">}</span></code></pre> <p>Now suppose you’ve created a controller’s method as follows:</p> <pre><code class="language-java"><span class="nd">@Get</span><span class="o">{</span><span class="s">"/customers"</span><span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">customers</span><span class="o">()</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="n">customersRepository</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">customers</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span>    
<span class="o">}</span></code></pre> <p>So far, so good. But what if we need to add a new attribute as a result. A new attribute that only makes sense to the new API version. How could we solve it? We could write a new class named as CustomerV2 with new attribute and rewrite the cotroller’s method so it could look like the following code:</p> <pre><code class="language-java"><span class="nd">@Get</span><span class="o">{</span><span class="s">"/{versionParameter}/customers"</span><span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">customers</span><span class="o">(</span><span class="n">String</span> <span class="n">versionParameter</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">versionParameter</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">version</span> <span class="o">==</span> <span class="mf">2.0</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">customersRepository</span><span class="o">.</span><span class="na">getAll</span><span class="o">()).</span><span class="na">serialize</span><span class="o">();</span>
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
        <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">customersRepository</span><span class="o">.</span><span class="na">getAllFromV2</span><span class="o">()).</span><span class="na">serialize</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>Certainly, that was not a well suited approach. Regarding that VRaptor comes with GSON lib from Google as a dependency, we can use the same Customer class just by inserting @Since annotation through our new versioned attributes. This annotation, tells that an attribute will be available since an specified version as follows at our new Customer class:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Customer</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">group</span><span class="o">;</span>

    <span class="nd">@Since</span><span class="o">(</span><span class="mf">2.0</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Calendar</span> <span class="n">registerDate</span><span class="o">;</span>    

    <span class="c1">// getters and setters omitted</span>
<span class="o">}</span></code></pre> <p>Now, the our method could be rewritten as follows:</p> <pre><code class="language-java"><span class="nd">@Get</span><span class="o">{</span><span class="s">"/{versionParameter}/customers"</span><span class="o">}</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">customers</span><span class="o">(</span><span class="n">String</span> <span class="n">versionParameter</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">double</span> <span class="n">version</span> <span class="o">=</span> <span class="n">Double</span><span class="o">.</span><span class="na">parseDouble</span><span class="o">(</span><span class="n">versionParameter</span><span class="o">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Customer</span><span class="o">&gt;</span> <span class="n">customers</span> <span class="o">=</span> <span class="n">customersRepository</span><span class="o">.</span><span class="na">getAll</span><span class="o">();</span>
    <span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">version</span><span class="o">(</span><span class="n">version</span><span class="o">).</span><span class="na">from</span><span class="o">(</span><span class="n">customers</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span>
<span class="o">}</span></code></pre> <p>That’s all. Now our API clients could request for a specified versioned result.</p> <p>The default XML Serialization implementation is based on XStream, then you can configure serialization by annotations or direct settings to XStream, just create the class:</p> <pre><code class="language-java"><span class="nd">@Specializes</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomXStreamBuilder</span> <span class="kd">extends</span> <span class="n">XStreamBuilderImpl</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="n">XStream</span> <span class="nf">xmlInstance</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">XStream</span> <span class="n">xStream</span> <span class="o">=</span> <span class="kd">super</span><span class="o">.</span><span class="na">xmlInstance</span><span class="o">();</span>
        <span class="c1">//your settings to XStream here</span>
        <span class="k">return</span> <span class="n">xStream</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>To configure the JSON serialization you can create a class that extends <code>GsonJSONSerialization</code> and overwrite the method <code>getSerializer()</code>.</p> <p>When serialiazing to JSON you can use the annotation <code>SkipSerialization</code> to omit the serialization of a field or class.</p> <p>The following class was annotated with <code>SkipSerialization</code>, thus it’s fields will never be serialized to JSON:</p> <pre><code class="language-java"><span class="nd">@SkipSerialization</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserPrivateInfo</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">document</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">phone</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">address</span><span class="o">;</span>
    
    <span class="c1">// getters and setters</span>
<span class="o">}</span></code></pre> <p>In this another class, the field password will not be serialized. The info field will not be serialized either due to the <code>UserPrivateInfo</code> class was annotated with <code>SkipSerialization</code> :</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">login</span><span class="o">;</span>
    
    <span class="nd">@SkipSerialization</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">password</span><span class="o">;</span>
    
    <span class="kd">private</span> <span class="n">UserPrivateInfo</span> <span class="n">info</span><span class="o">;</span>
    
    <span class="c1">// getters and setters</span>
<span class="o">}</span></code></pre> <p>Making the following call:</p> <pre><code class="language-java"><span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">withoutRoot</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">user</span><span class="o">).</span><span class="na">recursive</span><span class="o">().</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>The obtained result is similar to:</p> <pre><code class="language-javascript"><span class="p">{</span>
    <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John Smith"</span><span class="p">,</span>
    <span class="s2">"login"</span><span class="o">:</span> <span class="s2">"john"</span>
<span class="p">}</span></code></pre> <p>Note that the password field and the entire <code>UserPrivateInfo</code> wasn’t serialized.</p> <h2 id="serializing-collections">Serializing Collections</h2> <p>When serializing collections, by default is put the tag <code>list</code> around elements:</p> <pre><code class="language-java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Client</span><span class="o">&gt;</span> <span class="n">clients</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">clients</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span>
<span class="c1">//or</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">xml</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">clients</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span><span class="s2">"list"</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John"</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"Mary"</span> <span class="p">}</span>
<span class="p">]}</span></code></pre> <p>or</p> <pre><code class="language-xml"><span class="nt">&lt;list&gt;</span>
    <span class="nt">&lt;client&gt;</span>
        <span class="nt">&lt;name&gt;</span>John<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;/client&gt;</span>
    <span class="nt">&lt;client&gt;</span>
        <span class="nt">&lt;name&gt;</span>Mary<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;/client&gt;</span>
<span class="nt">&lt;/list&gt;</span></code></pre> <p>You can customize the outside element, using the method:</p> <pre><code class="language-java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Client</span><span class="o">&gt;</span> <span class="n">clients</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">clients</span><span class="o">,</span> <span class="s">"clients"</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span>
<span class="c1">//ou</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">xml</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">clients</span><span class="o">,</span> <span class="s">"clients"</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span><span class="s2">"clients"</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John"</span><span class="p">},</span>
    <span class="p">{</span><span class="s2">"name"</span><span class="o">:</span> <span class="s2">"Mary"</span><span class="p">}</span>
<span class="p">]}</span></code></pre> <p>or</p> <pre><code class="language-xml"><span class="nt">&lt;clients&gt;</span>
    <span class="nt">&lt;client&gt;</span>
        <span class="nt">&lt;name&gt;</span>John<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;/client&gt;</span>
    <span class="nt">&lt;client&gt;</span>
        <span class="nt">&lt;name&gt;</span>Mary<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;/client&gt;</span>
<span class="nt">&lt;/clients&gt;</span></code></pre> <p>The includes and excludes work as if you were applied in the element within the list. For example if you want include the address on the client:</p> <pre><code class="language-java"><span class="n">List</span><span class="o">&lt;</span><span class="n">Client</span><span class="o">&gt;</span> <span class="n">clients</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">clients</span><span class="o">).</span><span class="na">include</span><span class="o">(</span><span class="s">"address"</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>With result:</p> <pre><code class="language-javascript"><span class="p">{</span><span class="s2">"list"</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"John"</span><span class="p">,</span>
        <span class="s2">"address"</span><span class="o">:</span> <span class="p">{</span> <span class="s2">"street"</span><span class="o">:</span> <span class="s2">"Vergueiro, 3185"</span> <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">"name"</span><span class="o">:</span> <span class="s2">"Mary"</span><span class="p">,</span>
        <span class="s2">"address"</span><span class="o">:</span> <span class="p">{</span> <span class="s2">"street"</span><span class="o">:</span> <span class="s2">"Vergueiro, 3185"</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">]}</span></code></pre> <h2 id="json-serialization-without-root-element">JSON serialization without root element</h2> <p>If you want serialize an object in JSON format without naming it, you can do this with the method <code>withoutRoot</code>:</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">from</span><span class="o">(</span><span class="n">car</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span>
  <span class="s1">'car'</span><span class="o">:</span>
  <span class="p">{</span>
    <span class="s1">'color'</span><span class="o">:</span> <span class="s1">'blue'</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre> <p>and</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">withoutRoot</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">car</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span>
  <span class="s1">'color'</span><span class="o">:</span> <span class="s1">'blue'</span>
<span class="p">}</span></code></pre> <h2 id="json-and-xml-result-indentation">JSON and XML result indentation</h2> <p>By default, the serialization result is without indentation, that is useful to improve browser downloading time.</p> <pre><code class="language-java"><span class="n">result</span><span class="o">.</span><span class="na">use</span><span class="o">(</span><span class="n">json</span><span class="o">()).</span><span class="na">indented</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">car</span><span class="o">).</span><span class="na">serialize</span><span class="o">();</span></code></pre> <p>Will result something like:</p> <pre><code class="language-javascript"><span class="p">{</span>
  <span class="s1">'car'</span><span class="o">:</span>
  <span class="p">{</span>
    <span class="s1">'color'</span><span class="o">:</span> <span class="s1">'blue'</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre> <p>Or you can also use the <a href="../environment">Environment</a> to define the default indentation according with enviroment. In this case you can define that in <code>DEVELOPMENT</code> enviroment the indentation will be enabled, and in <code>PRODUCTION</code> enviroment will be disabled.</p> <p><code>development.properties</code>:</p> <pre><code class="language-properties"><span class="na">br.com.caelum.vraptor.serialization.xml.indented</span><span class="o">=</span><span class="s">true</span>
<span class="na">br.com.caelum.vraptor.serialization.json.indented</span><span class="o">=</span><span class="s">true</span></code></pre> <p><code>production.properties</code>:</p> <pre><code class="language-properties"><span class="na">br.com.caelum.vraptor.serialization.xml.indented</span><span class="o">=</span><span class="s">false</span>
<span class="na">br.com.caelum.vraptor.serialization.json.indented</span><span class="o">=</span><span class="s">false</span></code></pre> <p><strong>Note:</strong> The <code>Enviroment</code> settings has lower priority than code. In other words, if you define <code>br.com.caelum.vraptor.serialization.xml.indented=false</code> on <code>Enviroment</code> and call the <code>indented</code> method in your code, the result will be an indented JSON or XML.</p> <h2 id="creating-links-on-view-with-linkto">Creating links on view with linkTo</h2> <p>LinkTo is a functionality that allows you create links on JSP pages without writing link, but just indicating the class of controller, and the method.</p> <p>To the following controller:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientController</span> <span class="o">{</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">"/client/list"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">list</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// some logic here</span>
    <span class="o">}</span>

    <span class="nd">@Path</span><span class="o">(</span><span class="s">"/client/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">(</span><span class="n">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// some logic here</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre> <p>To call the <code>list</code> and <code>show</code> methods respectively, we would have to write the JSP:</p> <pre><code class="language-jsp"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/client/list"</span><span class="nt">&gt;</span>list clients<span class="nt">&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/client/1"</span><span class="nt">&gt;</span>show client 1<span class="nt">&lt;/a&gt;</span></code></pre> <p>Using the linkTo functionality, we can simplify the call to the <code>list</code> method:</p> <pre><code class="language-jsp"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${linkTo[ClientController].list()}"</span><span class="nt">&gt;</span>list clients<span class="nt">&lt;/a&gt;</span></code></pre> <p>Because the method have no parameters, you also can omit the parentheses.</p> <pre><code class="language-jsp"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${linkTo[ClientController].list}"</span><span class="nt">&gt;</span>list clients<span class="nt">&lt;/a&gt;</span></code></pre> <p>To call the <code>show</code> method, we can do a call like this:</p> <pre><code class="language-jsp"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${linkTo[ClientController].show(1)}"</span><span class="nt">&gt;</span>show client 1<span class="nt">&lt;/a&gt;</span></code></pre> <p>Instead of the fixed parameter, you can pass JSTL variables, for example:</p> <pre><code class="language-jsp"><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"${linkTo[ClientController].show(client.id)}"</span><span class="nt">&gt;</span>show client ${client.name}<span class="nt">&lt;/a&gt;</span></code></pre> <h2 id="automatic-parameters-inclusion">Automatic parameters inclusion</h2> <p>If you annotate your method with <code>@IncludeParameters</code>, all method parameters will be automatically included in the view.</p> <p>So, instead of doing something like:</p> <pre><code class="language-java"><span class="kd">public</span> <span class="kt">void</span> <span class="nf">filters</span><span class="o">(</span><span class="n">Interval</span> <span class="n">interval</span><span class="o">,</span> <span class="n">Representative</span> <span class="n">representative</span><span class="o">,</span>
        <span class="n">Unit</span> <span class="n">unit</span><span class="o">,</span> <span class="n">BigDecimal</span> <span class="n">maxValue</span><span class="o">,</span> <span class="n">BigDecimal</span> <span class="n">minValue</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// filter logic</span>

    <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"interval"</span><span class="o">,</span> <span class="n">interval</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"representative"</span><span class="o">,</span> <span class="n">representative</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"maxValue"</span><span class="o">,</span> <span class="n">maxValue</span><span class="o">);</span>
    <span class="n">result</span><span class="o">.</span><span class="na">include</span><span class="o">(</span><span class="s">"minValue"</span><span class="o">,</span> <span class="n">minValue</span><span class="o">);</span>
<span class="o">}</span></code></pre> <p>Now you can do:</p> <pre><code class="language-java"><span class="nd">@IncludeParameters</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">filters</span><span class="o">(</span><span class="n">Interval</span> <span class="n">interval</span><span class="o">,</span> <span class="n">Representative</span> <span class="n">representative</span><span class="o">,</span>
        <span class="n">Unit</span> <span class="n">unit</span><span class="o">,</span> <span class="n">BigDecimal</span> <span class="n">maxValue</span><span class="o">,</span> <span class="n">BigDecimal</span> <span class="n">minValue</span><span class="o">)</span> <span class="o">{</span>

    <span class="c1">// filter logic</span>
<span class="o">}</span></code></pre> <p>All the parameters will be available by JSP with EL: <code>${interval.begin}</code></p> </main> <script src="../../../js/search-en.js"></script> <script src="/js/headers.min.js"></script> </body> </html>